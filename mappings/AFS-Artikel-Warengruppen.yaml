version: 1
name: AFS-Artikel-Warengruppen

# Verfügbare Verbindungen werden über Rollen aus config/databases/databases.json aufgelöst
connections:
  afs_mssql:
    role: AFS_MSSQL
  afs_files_artikel:
    role: AFS_FILES_IMAGES
  afs_files_warengruppen:
    role: AFS_FILES_DOCUMENTS
  evo_main:
    role: EVO_MAIN
  xt_mysql:
    role: XT_MYSQL

entities:
  - name: Artikel
    source:
      connection: afs_mssql
      table: dbo.Artikel
      pk: ArtikelID
      fields:
        ArtikelID: dbo.Artikel.ArtikelID
        Artikelnummer: dbo.Artikel.Nummer
        Titel: dbo.Artikel.Titel
        WarengruppeID: dbo.Artikel.WarengruppeID
        BildPfad: AFS_FILES_IMAGES:products/images
    relations:
      - name: Artikel_Warengruppe
        from: dbo.Artikel.WarengruppeID
        to: dbo.Warengruppen.ID
  - name: Warengruppe
    source:
      connection: afs_mssql
      table: dbo.Warengruppen
      pk: ID
      fields:
        ID: dbo.Warengruppen.ID
        Name: dbo.Warengruppen.Name
        ParentID: dbo.Warengruppen.ParentID

# Ziel-Zuordnung (Beispiel – kann in evo.yaml detaillierter werden)
targets:
  - name: EVO
    connection: evo_main
    mappings:
      artikel:
        table: products
        key: products_id
        fields:
          products_model: Artikel.Artikelnummer
          products_name: Artikel.Titel | trim
      kategorien:
        table: categories
        key: categories_id
        fields:
          categories_name: Warengruppe.Name | trim
        relations:
          - from: Warengruppe.ParentID
            to: categories.parent_id
