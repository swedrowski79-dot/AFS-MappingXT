# target_sqlite.yml
# Configuration for SQLite target mapping (xt:Commerce EVO)
# Version: 1.0.0

version: 1.0.0

target:
  type: sqlite
  name: xt:Commerce EVO
  description: SQLite database for xt:Commerce EVO synchronization

connection:
  database: ${DATA_DB_PATH}
  mode: readwrite

# Entity mappings to target tables
entities:
  articles:
    table: Artikel
    primary_key: ID
    unique_key: Artikelnummer
    fields:
      ID:
        type: integer
        auto_increment: true
      AFS_ID:
        type: integer
        nullable: true
      XT_ID:
        type: integer
        nullable: true
      Art:
        type: string
        nullable: true
      Artikelnummer:
        type: string
        required: true
      Bezeichnung:
        type: string
        required: true
      EANNummer:
        type: string
        nullable: true
      Bestand:
        type: integer
        nullable: true
      Preis:
        type: real
        nullable: true
      AFS_Warengruppe_ID:
        type: integer
        nullable: true
      XT_Category_ID:
        type: integer
        nullable: true
      Category:
        type: integer
        nullable: true
      Master:
        type: integer
        default: 0
        required: true
      Masterartikel:
        type: string
        nullable: true
      Mindestmenge:
        type: integer
        nullable: true
      Gewicht:
        type: real
        nullable: true
      Online:
        type: integer
        default: 0
        required: true
      Einheit:
        type: string
        nullable: true
      Langtext:
        type: string
        nullable: true
      Werbetext:
        type: string
        nullable: true
      Meta_Title:
        type: string
        nullable: true
      Meta_Description:
        type: string
        nullable: true
      Bemerkung:
        type: string
        nullable: true
      Hinweis:
        type: string
        nullable: true
      update:
        type: integer
        default: 0
        required: true
      last_update:
        type: string
        nullable: true
      last_imported_hash:
        type: string
        nullable: true
      last_seen_hash:
        type: string
        nullable: true

  categories:
    table: category
    primary_key: ID
    unique_key: afsid
    fields:
      ID:
        type: integer
        auto_increment: true
      Parent:
        type: integer
        nullable: true
      afsid:
        type: integer
        required: true
      afsparent:
        type: integer
        nullable: true
      xtid:
        type: integer
        nullable: true
      name:
        type: string
        required: true
      online:
        type: integer
        default: 0
      picture:
        type: string
        nullable: true
      picture_id:
        type: integer
        nullable: true
      picture_big:
        type: string
        nullable: true
      picture_big_id:
        type: integer
        nullable: true
      description:
        type: string
        nullable: true
      meta_title:
        type: string
        nullable: true
      meta_description:
        type: string
        nullable: true
      update:
        type: integer
        default: 0
      last_imported_hash:
        type: string
        nullable: true
      last_seen_hash:
        type: string
        nullable: true

  images:
    table: Bilder
    primary_key: ID
    unique_key: Bildname
    fields:
      ID:
        type: integer
        auto_increment: true
      XT_ID:
        type: integer
        nullable: true
      Bildname:
        type: string
        required: true
      md5:
        type: string
        nullable: true
      update:
        type: integer
        default: 0
      uploaded:
        type: integer
        default: 0
      last_imported_hash:
        type: string
        nullable: true
      last_seen_hash:
        type: string
        nullable: true

  documents:
    table: Dokumente
    primary_key: ID
    unique_key: Titel
    fields:
      ID:
        type: integer
        auto_increment: true
      XT_ID:
        type: integer
        nullable: true
      Titel:
        type: string
        required: true
      Dateiname:
        type: string
        nullable: true
      Art:
        type: integer
        nullable: true
      md5:
        type: string
        nullable: true
      update:
        type: integer
        default: 0
      uploaded:
        type: integer
        default: 0
      last_imported_hash:
        type: string
        nullable: true
      last_seen_hash:
        type: string
        nullable: true

  attributes:
    table: Attribute
    primary_key: ID
    unique_key: Attribname
    fields:
      ID:
        type: integer
        auto_increment: true
      XT_Attrib_ID:
        type: integer
        nullable: true
      Attribname:
        type: string
        required: true
      update:
        type: integer
        default: 0
      last_imported_hash:
        type: string
        nullable: true
      last_seen_hash:
        type: string
        nullable: true

# Relationship tables
relationships:
  article_images:
    table: Artikel_Bilder
    foreign_keys:
      - column: Artikel_ID
        references: Artikel.ID
      - column: Bild_ID
        references: Bilder.ID
    unique_constraint: [Artikel_ID, Bild_ID]
    fields:
      ID:
        type: integer
        auto_increment: true
      XT_ARTIKEL_ID:
        type: integer
        nullable: true
      XT_Bild_ID:
        type: integer
        nullable: true
      Artikel_ID:
        type: integer
        required: true
      Bild_ID:
        type: integer
        required: true
      Bildnummer:
        type: integer
        nullable: true
      update:
        type: integer
        default: 0

  article_documents:
    table: Artikel_Dokumente
    foreign_keys:
      - column: Artikel_ID
        references: Artikel.ID
      - column: Dokument_ID
        references: Dokumente.ID
    unique_constraint: [Artikel_ID, Dokument_ID]
    fields:
      ID:
        type: integer
        auto_increment: true
      XT_ARTIKEL_ID:
        type: integer
        nullable: true
      XT_Dokument_ID:
        type: integer
        nullable: true
      Artikel_ID:
        type: integer
        required: true
      Dokument_ID:
        type: integer
        required: true
      update:
        type: integer
        default: 0

  article_attributes:
    table: Attrib_Artikel
    foreign_keys:
      - column: Artikel_ID
        references: Artikel.ID
      - column: Attribute_ID
        references: Attribute.ID
    unique_constraint: [Attribute_ID, Artikel_ID]
    fields:
      ID:
        type: integer
        auto_increment: true
      XT_Attrib_ID:
        type: integer
        nullable: true
      XT_Artikel_ID:
        type: integer
        nullable: true
      Attribute_ID:
        type: integer
        required: true
      Artikel_ID:
        type: integer
        required: true
      Atrribvalue:
        type: string
        nullable: true
      update:
        type: integer
        default: 0

# Delta tracking configuration
delta:
  enabled: true
  export_database: ${DELTA_DB_PATH}
  track_field: update
  export_on_complete: true

# Hash-based change detection configuration
# All fields included in the full hash computation for articles
# Fields excluded: ID, xt_id, afs_id, update, last_update, last_update_ts, last_imported_hash, last_seen_hash
hash_fields:
  articles:
    # All business data fields that should trigger updates when changed
    included:
      - Art
      - Artikelnummer
      - Bezeichnung
      - EANNummer
      - Bestand
      - Preis
      - AFS_Warengruppe_ID
      - XT_Category_ID
      - Category
      - Master
      - Masterartikel
      - Mindestmenge
      - Gewicht
      - Online
      - Einheit
      - Langtext
      - Werbetext
      - Meta_Title
      - Meta_Description
      - Bemerkung
      - Hinweis
      - Bild1
      - Bild2
      - Bild3
      - Bild4
      - Bild5
      - Bild6
      - Bild7
      - Bild8
      - Bild9
      - Bild10
