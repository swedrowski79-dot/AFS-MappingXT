version: 1
connection: evo
introspect: true

tables:
  artikel:
    primary_key: [id]
    business_key: [model]
    unique_constraint: [model]
    fields:
      - id                # surrogate PK (Auto-Inc; introspektiert)
      - afs_id            # afs.artikel (ID in AFS)
      - xt_id             # XT Product.id
      - model             # AFS.Artikelnummer
      - name              # AFS.Bezeichnung1
      - ean               # EAN
      - description_html  # Beschreibung → HTML
      - promo_html        # Werbetext1 → HTML
      - note_html         # Bemerkung/Hinweis → HTML
      - unit              # Einheit
      - gross_weight      # Bruttogewicht
      - price             # VK3 (Brutto)
      - tax_class_id      # aus AFS.Umsatzsteuer gemappt
      - stock             # Bestand
      - status            # 1=online, 0=offline (aus AFS.Internet)
      - meta_title        # Meta-Titel
      - meta_description  # Meta-Beschreibung
      - change            # artikel.change
      - category          # Warengruppe oder category
      - is_master         # Flag ob Artikel ein Master ist
      - master_model      # Zugehörige Master-Artikelnummer
      - products_image    # Hauptbild (AFS Bild1)
      - products_name     # Produktname (Kompatibilität)
      - products_description # Produktbeschreibung (Langtext)
      - seo_slug          # SEO-freundlicher URL-Slug
      - source_hash       # Hash aller Quellfelder
      - updated_at        # artikel.updated_at

  category:
    primary_key: [id]
    business_key: [afs_id]
    unique_constraint: [afs_id]
    fields:
      - id              # surrogate PK (Auto-Inc; introspektiert)
      - afs_id          # AFS.Warengruppe (ID in AFS)
      - xt_id           # xt category.id
      - name
      - level            # AFS.Ebene
      - attachment       # AFS.Anhang
      - parent_id       # Parent-ID (AFS.Anhang)
      - status
      - image            # Bild
      - image_large      # Bild_gross
      - description_html # Beschreibung → HTML
      - description      # Beschreibung (Text/HTML)
      - meta_description # Meta-Beschreibung
      - meta_title       # Meta-Titel
      - seo_slug         # SEO-URL: de/<pfad>
      - change
      - source_hash
      - updated_at
      
  media:
    primary_key: [media_id]
    unique_constraint: [hash, class, type]
    business_key: [hash, class, type]
    fields:
      media_id:
        type: integer
        auto_increment: true
        not_null: true
      file_name:
        type: text
        not_null: true
      stored_file:
        type: text
      stored_path:
        type: text
      mime:
        type: text
      file_size:
        type: integer
      hash:
        type: text
        not_null: true
      class:
        type: text
        not_null: true
      type:
        type: text
        not_null: true
      status:
        type: integer
        default: 1
        not_null: true
      change:
        type: integer
        default: 0
        not_null: true
      upload:
        type: integer
        default: 0
        not_null: true
      stored_at:
        type: text
      updated_at:
        type: text

  media_relation:
    primary_key: [relation_id]
    unique_constraint: [file_name, entity_type, entity_id]
    fields:
      relation_id:
        type: integer
        auto_increment: true
        not_null: true
      file_name:
        type: text
        not_null: true
      entity_type:
        type: text
        not_null: true
      entity_id:
        type: text
        not_null: true
      hash:
        type: text
      position:
        type: integer
        default: 0
        not_null: true
      status:
        type: integer
        default: 1
        not_null: true
      change:
        type: integer
        default: 0
        not_null: true
      updated_at:
        type: text

  file_vault:
    keys: [file_name]
    fields:
      - file_name
      - checksum
      - md5
      - size
      - mtime
      - ext
      - mime
      - source_path
      - stored_file
      - stored_path
      - stored_at
      - change
      - updated_at

  file_vault_images:
    keys: [file_name]
    fields:
      - file_name
      - checksum
      - md5
      - size
      - mtime
      - ext
      - mime
      - source_path
      - stored_file
      - stored_path
      - stored_at
      - change
      - updated_at

  file_vault_bilder:
    keys: [file_name]
    fields:
      - file_name
      - checksum
      - md5
      - size
      - mtime
      - ext
      - mime
      - source_path
      - stored_file
      - stored_path
      - stored_at
      - change
      - updated_at

  file_vault_documents:
    keys: [file_name]
    fields:
      - file_name
      - checksum
      - md5
      - size
      - mtime
      - ext
      - mime
      - source_path
      - stored_file
      - stored_path
      - stored_at
      - change
      - updated_at

  file_vault_dokumente:
    keys: [file_name]
    fields:
      - file_name
      - checksum
      - md5
      - size
      - mtime
      - ext
      - mime
      - source_path
      - stored_file
      - stored_path
      - stored_at
      - change
      - updated_at

  attribute:              # einfache Attribut-Stammtabelle (Name dedupliziert)
    primary_key: [id]
    keys: [name]
    unique_constraint: [name]
    fields:
      id:
        type: integer
        auto_increment: true
        not_null: true
      xt_id:
        type: integer
      name:
        type: text
      updated_at:
        type: text

  artikel_attribute:      # M:N: Artikel ↔ Attribut (einfach: eine Value-Spalte)
    keys: [artikel_id, attribute_id]
    fields:
      - artikel_id    # artikel.id
      - attribute_id  # attribute.attribute_id
      - status        # artikel_attribute.status
      - value         # Attributwert
      - updated_at    # Attribut aktualisiert am

  
