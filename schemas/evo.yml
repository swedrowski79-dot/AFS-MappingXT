version: 1
connection: evo
introspect: true

tables:
  artikel:
    keys: [id]
    business_key: [model]
    explicit_unique: [model]
    unique_constraint: [model]
    fields:
      - id                # surrogate PK (Auto-Inc; introspektiert)
      - model             # = AFS.Artikelnummer
      - name              # = AFS.Bezeichnung1
      - ean               # EAN
      - description_html  # Beschreibung → HTML
      - promo_html        # Werbetext1 → HTML
      - note_html         # Bemerkung/Hinweis → HTML
      - unit              # Einheit
      - gross_weight      # Bruttogewicht
      - price             # VK3 (Brutto)
      - tax_class_id      # aus AFS.Umsatzsteuer gemappt
      - stock             # Bestand
      - status            # 1=online, 0=offline (aus AFS.Internet)
      - meta_title        # Meta-Titel
      - meta_description  # Meta-Beschreibung
      - change            # artikel.change
      - category          # Warengruppe oder category
      - is_master         # Flag ob Artikel ein Master ist
      - master_model      # Zugehörige Master-Artikelnummer
      - products_image    # Hauptbild (AFS Bild1)
      - products_name     # Produktname (Kompatibilität)
      - products_description # Produktbeschreibung (Langtext)
      - seo_slug          # SEO-freundlicher URL-Slug
      - source_hash       # Hash aller Quellfelder
      - updated_at        # artikel.updated_at

  artikel_system:
    keys: [id]
    fields:
      - id                # artikel.id in EVO
      - afs_id            # artikel_id in AFS
      - xt_id             # artikel.id in XT

  category:
    keys: [cat_id]
    fields:
      - cat_id           # AFS.Warengruppe
      - name
      - level            # AFS.Ebene
      - attachment       # AFS.Anhang
      - status
      - image            # Bild
      - image_large      # Bild_gross
      - description_html # Beschreibung → HTML
      - description      # Beschreibung (Text/HTML)
      - meta_description # Meta-Beschreibung
      - meta_title       # Meta-Titel
      - change
      - source_hash
      - updated_at

  category_system:
    keys: [id]
    fields:
      - id              # category.id in EVO
      - afs_id          # category.cat_id in AFS
      - xt_id           # category.id in XT
      
  media:
    primary_key: [media_id]
    unique_constraint: [hash, kind]
    business_key: [hash, kind]
    fields:
      media_id:
        type: integer
        auto_increment: true
        not_null: true
      file_name:
        type: text
        not_null: true
      stored_file:
        type: text
      stored_path:
        type: text
      mime:
        type: text
      file_size:
        type: integer
      hash:
        type: text
        not_null: true
      kind:
        type: text
        not_null: true
      status:
        type: integer
        default: 1
        not_null: true
      change:
        type: integer
        default: 0
        not_null: true
      upload:
        type: integer
        default: 0
        not_null: true
      stored_at:
        type: text
      updated_at:
        type: text

  media_relation:
    primary_key: [relation_id]
    unique_constraint: [file_name, entity_type, entity_id]
    fields:
      relation_id:
        type: integer
        auto_increment: true
        not_null: true
      file_name:
        type: text
        not_null: true
      entity_type:
        type: text
        not_null: true
      entity_id:
        type: text
        not_null: true
      hash:
        type: text
      position:
        type: integer
        default: 0
        not_null: true
      status:
        type: integer
        default: 1
        not_null: true
      change:
        type: integer
        default: 0
        not_null: true
      updated_at:
        type: text

  file_vault:
    keys: [file_name]
    fields:
      - file_name     # eindeutiger Dateiname im Vault
      - checksum      # Dateiprüfziffer
      - md5           # MD5-Hash
      - size          # Dateigröße
      - mtime         # Änderungsdatum
      - ext           # Dateiendung
      - mime          # MIME-Typ
      - source_path
      - stored_file
      - stored_path   
      - stored_at     
      - change        # Datei geändert am              
      - updated_at    # Datei aktualisiert am

  attribute:              # einfache Attribut-Stammtabelle (Name dedupliziert)
    keys: [name]
    fields:
      - attribute_id  # attribute_id in EVO(Auto-Inc; introspektiert)
      - name          # Attributname
      - updated_at    # Attribut aktualisiert am

  attribute_system:
    keys: [id]
    fields:
      - id         # attribute.id in EVO
      - xt_id      # attribute.attribute_id in XT

  artikel_attribute:      # M:N: Artikel ↔ Attribut (einfach: eine Value-Spalte)
    keys: [id, attribute_id]
    fields:
      - id            # artikel.id
      - attribute_id  # attribute.attribute_id
      - status        # artikel_attribute.status
      - value         # Attributwert
      - updated_at    # Attribut aktualisiert am

  artikel_attribute_system:
    keys: [id]
    fields:
      - id         # artikel_attribute.id in EVO
      - xt_id      # artikel_attribute.attribute_id in XT
