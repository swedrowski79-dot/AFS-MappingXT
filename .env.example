# Environment Configuration for AFS-MappingXT
# Copy this file to .env and adjust values as needed
#
# All configuration values can be set via environment variables.
# This provides a unified approach to configuration management.

# ============================================================================
# Security Configuration
# ============================================================================

# Enable security mode (true/false)
# When enabled, direct access to index.php and indexcli.php is blocked
# Access is only allowed when calls originate from the api/ directory
AFS_SECURITY_ENABLED=false

# ============================================================================
# Docker/Web Server Configuration
# ============================================================================

# HTTP Port for Apache
HTTP_PORT=8080

# Adminer Port (optional database management tool)
ADMINER_PORT=8081

# ============================================================================
# PHP Configuration
# These values are used by the Docker entrypoint to configure PHP
# ============================================================================

# PHP Memory Limit (e.g., 256M, 512M, 1G)
PHP_MEMORY_LIMIT=256M

# PHP Maximum Execution Time in seconds (for long-running sync operations)
PHP_MAX_EXECUTION_TIME=300

# Timezone for PHP and system
TZ=Europe/Berlin

# ============================================================================
# OPcache Configuration (PHP Bytecode Cache)
# ============================================================================

# OPcache memory for compiled scripts (in MB)
# Recommended: 128-256MB for small apps, 256-512MB for medium apps
OPCACHE_MEMORY_CONSUMPTION=256

# Memory for interned strings (in MB)
# Recommended: 16-32MB for typical applications
OPCACHE_INTERNED_STRINGS_BUFFER=16

# Maximum number of files that can be cached
# Should be higher than actual PHP file count in project
OPCACHE_MAX_ACCELERATED_FILES=10000

# File timestamp revalidation frequency (in seconds)
# Production: 60-300 (check rarely), Development: 0-2 (check often)
OPCACHE_REVALIDATE_FREQ=60

# Validate file timestamps on every request (0=off, 1=on)
# Production: 0 (use revalidate_freq), Development: 1 (always check)
OPCACHE_VALIDATE_TIMESTAMPS=0

# Enable huge code pages for better performance (0=off, 1=on)
# Only works on Linux with transparent huge pages enabled
# Can improve performance by 5-10% when available
OPCACHE_HUGE_CODE_PAGES=0

# ============================================================================
# JIT (Just-In-Time) Compilation Configuration (PHP 8.0+)
# ============================================================================

# JIT Mode - How JIT compiles hot code
# Options: "disable", "tracing" (recommended), "function", or numeric (e.g., 1254)
# - "tracing" (1255): Best for web apps, traces execution paths
# - "function" (1205): Good for CPU-intensive apps
# - "disable" (0): Turn off JIT completely
OPCACHE_JIT_MODE=tracing

# JIT Buffer Size - Memory for JIT compiled native code
# Recommended: 64-128MB for typical apps, 128-256MB for complex apps
# Set to 0 to disable JIT (also disables with JIT_MODE=disable)
OPCACHE_JIT_BUFFER_SIZE=128M

# ============================================================================
# MSSQL Database Connection
# Connection details for the AFS-ERP MSSQL database
# Hinweis: Präferiere die Verwaltung über config/databases/databases.json oder die Weboberfläche.
# Diese Variablen dienen nur noch als Fallback.
# ============================================================================

AFS_MSSQL_HOST=10.0.1.82
AFS_MSSQL_PORT=1435
AFS_MSSQL_DB=AFS_2018
AFS_MSSQL_USER=sa
AFS_MSSQL_PASS=W3laf!x

# ============================================================================
# Application Configuration
# These values control the behavior of the AFS-MappingXT application
# ============================================================================

# Media Source Directory (for images and documents)
# This should point to the network share or directory containing media files
AFS_MEDIA_SOURCE=/var/www/data

# Metadata Directories (optional)
# Directories containing additional metadata for articles and categories
# Leave empty if not used (empty = not configured)
AFS_METADATA_ARTICLES=
AFS_METADATA_CATEGORIES=

# Maximum Error Log Entries (before rotation)
AFS_MAX_ERRORS=200

# Log Rotation (days to keep log files)
AFS_LOG_ROTATION_DAYS=30

# Mapping Version (for change tracking in logs)
AFS_MAPPING_VERSION=1.0.0

# Enable File Logging (JSON logs to files)
AFS_ENABLE_FILE_LOGGING=true

# Log Level (Minimum level to log: 'info', 'warning', 'error')
# Use 'warning' for lean logging (recommended), 'info' for verbose, 'error' for critical only
AFS_LOG_LEVEL=warning

# Log Sample Size (Number of items in error/warning sample arrays)
# Use smaller values (e.g., 5) for lean logging
AFS_LOG_SAMPLE_SIZE=5

# ============================================================================
# GitHub Auto-Update Configuration
# Automatically checks for updates on GitHub and pulls changes when starting
# ============================================================================

# Enable/Disable automatic updates from GitHub (true/false)
# When enabled, the application will check for updates and automatically pull
# changes from GitHub when starting via CLI or web interface.
# The .env file is protected and will not be overwritten.
AFS_GITHUB_AUTO_UPDATE=true

# GitHub Branch to update from (leave empty to use current branch)
# Example: main, master, develop
AFS_GITHUB_BRANCH=

# ============================================================================
# Multi-Database Sync Configuration
# Configure multiple source-target mapping pairs for flexible data flows
# ============================================================================

# XT-Commerce MySQL Database Configuration
# Hinweis: Bevorzugt über config/databases/databases.json pflegen. Diese Werte dienen als Fallback.
XT_MYSQL_HOST=localhost
XT_MYSQL_PORT=3306
XT_MYSQL_DB=xtcommerce
XT_MYSQL_USER=xt_user
XT_MYSQL_PASS=xt_password

# Sync Mapping Configuration
# Define source and target YAML files for each sync pair
# Format: SOURCE_MAPPING and TARGET_MAPPING for primary sync
#         SOURCE_MAPPING_2, TARGET_MAPPING_2 for additional syncs

# Primary Sync: AFS (MSSQL) → EVO (SQLite) über YAML-Mappings
SOURCE_MAPPING=mappings/afs.yml
TARGET_MAPPING=mappings/target_sqlite.yml
RULE_MAPPING=mappings/afs_evo.yml
SCHEMA_MAPPING=mappings/evo.yml

# Database Paths for Additional Syncs
# Hinweis: Wird überschrieben, sobald eine ORDERS_* Rolle in databases.json hinterlegt ist.
ORDERS_DB_PATH=db/orders_evo.db
ORDERS_DELTA_DB_PATH=db/orders_evo_delta.db

# Sync Interface Actions
# Specify which sync operations should be enabled
# Options: sync_afs_to_evo, sync_xt_orders_to_evo, sync_evo_to_xt
SYNC_ENABLED_ACTIONS=sync_afs_to_evo

# Advanced: Enable bidirectional sync
SYNC_BIDIRECTIONAL=false

# ============================================================================
# Server-to-Server Data Transfer API Configuration
# Secure data transfer between different servers for databases, images, and documents
# ============================================================================

# API Key for authentication (REQUIRED - generate a secure random key)
# Example: openssl rand -hex 32
DATA_TRANSFER_API_KEY=your_secure_api_key_here

# Database Transfer Configuration
# Source and target paths for delta database transfer
DB_TRANSFER_SOURCE=db/evo_delta.db
DB_TRANSFER_TARGET=db/evo_delta.db

# Images Transfer Configuration
# Source and target directories for image files

# Documents Transfer Configuration
# Source and target directories for document files

# Enable/Disable transfer types
DATA_TRANSFER_ENABLE_DB=true
DATA_TRANSFER_ENABLE_IMAGES=true
DATA_TRANSFER_ENABLE_DOCUMENTS=true

# Transfer options
DATA_TRANSFER_MAX_FILE_SIZE=104857600
DATA_TRANSFER_LOG_TRANSFERS=true

# ============================================================================
# Remote Server Monitoring Configuration
# Monitor the status of remote/slave servers in the web interface
# ============================================================================

# Enable remote server monitoring (true/false)
REMOTE_SERVERS_ENABLED=false

# Remote servers to monitor (comma-separated list)
# Format: Name|URL|API_Key|Database
# API_Key and Database are optional – leave empty to skip a field, e.g. Server|https://example.com||evo.db
# Example: Server1|https://server1.example.com|key123|evo.db,Server2|https://server2.example.com||orders_evo.db
# The API_Key is optional and only needed if the remote server requires authentication
REMOTE_SERVERS=

# Timeout for remote server requests in seconds (default: 5)
REMOTE_SERVER_TIMEOUT=5
